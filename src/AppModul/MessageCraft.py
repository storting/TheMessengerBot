import pymorphy3
import re
from rusgenderdetection import get_gender

textEnd = f"""
            –ì–æ—Ç–æ–≤—ã –≤–∑—è—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é –ø—Ä–∞–∑–¥–Ω–∏–∫–∞ –≤ –Ω–∞—à–∏ –∑–∞–±–æ—Ç–ª–∏–≤—ã–µ –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ä—É–∫–∏:
            *-–õ–∞–∑–µ—Ä—Ç–∞–≥ –∏–≥—Ä–∞,*
            *-–ê–Ω–∏–º–∞—Ç–æ—Ä,*
            *-–§–æ—Ç–æ–≥—Ä–∞—Ñ,*
            *-–ö–æ–º–Ω–∞—Ç–∞ –æ—Ç–¥—ã—Ö–∞ –¥–ª—è –ø—Ä–∞–∑–¥–Ω–æ–≤–∞–Ω–∏—è,*
            *-–°–∫–∞–ª–∞–¥—Ä–æ–º*
            –ü—Ä–∏–≥–ª–∞—à–∞–µ–º –ø–æ—Å–µ—Ç–∏—Ç—å –Ω–∞—à –ª–∞–∑–µ—Ä—Ç–∞–≥ –∫–ª—É–±!üéØüî´

            –ü—Ä–∏—è—Ç–Ω—ã–π —Å—é—Ä–ø—Ä–∏–∑, —Ç–æ–ª—å–∫–æ –¥–ª—è –í–∞—Å *10% —Å–∫–∏–¥–∫–∞* –ø—Ä–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏–≥—Ä—ã –ª–∞–∑–µ—Ä—Ç–∞–≥!üî•

            –í–º–µ—Å—Ç–æ ~1000 —Ä—É–±–ª–µ–π~ üôÖ‚Äç‚ôÄ‚õî, —Ü–µ–Ω–∞ 2-—Ö —á–∞—Å–æ–≤–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã –¥–ª—è –≤–∞—à–µ–π –≥—Ä—É–ø–ø—ã –ø–æ —Å—Ç–∞—Ä—ã–º —Ü–µ–Ω–∞ *900—Ä—É–±–ª–µ–π* –∑–∞ –∏–≥—Ä–æ–∫–∞ üï∫üèªüî• 

            –ù–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏ –º–æ—Ä–µ —ç–º–æ—Ü–∏–π!üòç 

            –°–∞–π—Ç https://www.ataka154.ru/
            –í–∫  https://vk.com/ataka_154

            _üìå–ë—É–¥–µ–º –±–ª–∞–≥–æ–¥–∞—Ä–Ω—ã –∑–∞ –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å, –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –≤ –Ω–∞—à–µ–º –∫–ª—É–±–µ –ª–∏–±–æ —É–∂–µ –¥—Ä—É–≥–∏–µ –ø–ª–∞–Ω—ã_

            PS: –ñ–µ–ª–∞—é —Ö–æ—Ä–æ—à–µ–≥–æ –í–∞–º –¥–Ω—è, –º–Ω–æ–≥–æ —É–ª—ã–±–æ–∫, –∏ —Å—á–∞—Å—Ç–ª–∏–≤—ã—Ö¬†–º–æ–º–µ–Ω—Ç–æ–≤!
            """

morph = pymorphy3.MorphAnalyzer()

class Message:
    def __init__(self, nameCustumer, nameBirthday):
        self.nameCustumer = nameCustumer
        self.nameBirthday = nameBirthday

    def ProcessingData(self):
        text = f"""–î–æ–±—Ä—ã–π –¥–µ–Ω—å!‚ò∫üå∫‚ù§
        
        –í–∞—Å –±–µ—Å–ø–æ–∫–æ–∏—Ç –í–ª–∞–¥–∏—Å–ª–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ª–∞–∑–µ—Ä—Ç–∞–≥ –∫–ª—É–±–∞ –ê–¢–ê–ö–ê üî´üß®–Ω–∞ –¢—Ä–æ–ª–ª–µ–π–Ω–æ–π 37ü´°
        
        –°–∫–æ—Ä–æ –ø–æ—Ä–∞ –ø–µ—Ä–µ–º–µ–Ω—ã—Ö –∏ –ø–µ—Ä–≤—ã—Ö —à–∞–≥–æ–≤!üéàüéä–ú—ã –º–æ–∂–µ–º –ø–æ–º–æ—á—å —ç—Ç–æ–º—É —Å–æ–±—ã—Ç–∏—é –∑–∞–ø–æ–º–Ω–∏—Ç—Å—å—è‚ò∫üå∫
                        """
        self.nameCustumer = self.clean_name(self.nameCustumer)
        self.nameBirthday = self.clean_name(self.nameBirthday)
        if(self.nameCustumer != None and self.is_personal_name(self.nameCustumer)):            
            if(self.nameBirthday != None and self.is_personal_name(self.nameBirthday)):
                self.nameBirthday = self.decline_name(self.nameBirthday)
                if(self.get_gender_name(self.nameBirthday) == 1):
                    text = f"""*{self.nameCustumer.title()}* –¥–æ–±—Ä—ã–π –¥–µ–Ω—å!‚ò∫üå∫‚ù§
                    –í–∞—Å –±–µ—Å–ø–æ–∫–æ–∏—Ç –í–ª–∞–¥–∏—Å–ª–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ª–∞–∑–µ—Ä—Ç–∞–≥ –∫–ª—É–±–∞ –ê–¢–ê–ö–ê üî´üß®–Ω–∞ –¢—Ä–æ–ª–ª–µ–π–Ω–æ–π 37ü´°
                    
                    –ù–µ –∑–∞ –≥–æ—Ä–∞–º–∏ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è –í–∞—à–µ–≥–æ —Å—ã–Ω–∞ *{self.nameBirthday.title()}*üéÇ‚ù§, _–≤—ã –µ—â–µ –Ω–µ –¥—É–º–∞–ª–∏ –Ω–∞–¥ –ø–æ–¥–∞—Ä–∫–æ–ºüéÅ, –∫–∞–∫ –∏ –≥–¥–µ –±—É–¥–µ—Ç–µ –æ—Ç–º–µ—á–∞—Ç—å?üéàüéäüéâ_
                                """
                elif(self.get_gender_name(self.nameBirthday) == 0):
                    text = f"""*{self.nameCustumer.title()}* –¥–æ–±—Ä—ã–π –¥–µ–Ω—å!‚ò∫üå∫‚ù§
                    
                    –í–∞—Å –±–µ—Å–ø–æ–∫–æ–∏—Ç –í–ª–∞–¥–∏—Å–ª–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ª–∞–∑–µ—Ä—Ç–∞–≥ –∫–ª—É–±–∞ –ê–¢–ê–ö–ê üî´üß®–Ω–∞ –¢—Ä–æ–ª–ª–µ–π–Ω–æ–π 37ü´°
                    
                    –ù–µ –∑–∞ –≥–æ—Ä–∞–º–∏ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è –í–∞—à–µ–π –¥–æ—á–µ—Ä–∏ *{self.nameBirthday.title()}*üéÇ‚ù§, _–≤—ã –µ—â–µ –Ω–µ –¥—É–º–∞–ª–∏ –Ω–∞–¥ –ø–æ–¥–∞—Ä–∫–æ–ºüéÅ, –∫–∞–∫ –∏ –≥–¥–µ –±—É–¥–µ—Ç–µ –æ—Ç–º–µ—á–∞—Ç—å?üéàüéäüéâ_
                                """
            else:
                text = f"""
                *{self.nameCustumer.title()}* –¥–æ–±—Ä—ã–π –¥–µ–Ω—å!‚ò∫üå∫‚ù§
                
                –í–∞—Å –±–µ—Å–ø–æ–∫–æ–∏—Ç –í–ª–∞–¥–∏—Å–ª–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ª–∞–∑–µ—Ä—Ç–∞–≥ –∫–ª—É–±–∞ –ê–¢–ê–ö–ê üî´üß®–Ω–∞ –¢—Ä–æ–ª–ª–µ–π–Ω–æ–π 37ü´°
                
                –°–∫–æ—Ä–æ –ø–æ—Ä–∞ –ø–µ—Ä–µ–º–µ–Ω—ã—Ö –∏ –ø–µ—Ä–≤—ã—Ö —à–∞–≥–æ–≤!üéàüéä–ú—ã –º–æ–∂–µ–º –ø–æ–º–æ—á—å —ç—Ç–æ–º—É —Å–æ–±—ã—Ç–∏—é –∑–∞–ø–æ–º–Ω–∏—Ç—Å—å—è‚ò∫üå∫
                            """
        else:
            text = f"""
            –î–æ–±—Ä—ã–π –¥–µ–Ω—å!‚ò∫üå∫‚ù§
            
            –í–∞—Å –±–µ—Å–ø–æ–∫–æ–∏—Ç –í–ª–∞–¥–∏—Å–ª–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ª–∞–∑–µ—Ä—Ç–∞–≥ –∫–ª—É–±–∞ –ê–¢–ê–ö–ê üî´üß®–Ω–∞ –¢—Ä–æ–ª–ª–µ–π–Ω–æ–π 37ü´°
            
            –°–∫–æ—Ä–æ –ø–æ—Ä–∞ –ø–µ—Ä–µ–º–µ–Ω—ã—Ö –∏ –ø–µ—Ä–≤—ã—Ö —à–∞–≥–æ–≤!üéàüéä–ú—ã –º–æ–∂–µ–º –ø–æ–º–æ—á—å —ç—Ç–æ–º—É —Å–æ–±—ã—Ç–∏—é –∑–∞–ø–æ–º–Ω–∏—Ç—Å—å—è‚ò∫üå∫
                        """
        return text
    
    def final_form_massage(self):
        self.final_text = self.ProcessingData() + textEnd
        return self.final_text

    def is_personal_name(self, word):
        parsed_word = morph.parse(word)[0]

        return ('Name' in parsed_word.tag) or False

    def decline_name(self, name):
        cleaned_text = re.sub(r'[^\u0400-\u04FF\s]', '', name)
        butyavka = morph.parse(cleaned_text.strip())[0]
        gent = butyavka.inflect({'gent'})

        return gent.word
    
    def clean_name(self, name):
        cleaned_text = re.sub(r'[^\u0400-\u04FF\s]', '', name)
        return cleaned_text
    
    def get_gender_name(self, name):
        parse_result = morph.parse(name)[0]
        normalForm = parse_result.normal_form
        return get_gender(normalForm)